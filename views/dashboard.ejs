<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/src/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/src/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/src/favicon-16x16.png"
    />

    <meta charset="UTF-8" />
    <meta name="title" content="Image Uploader" />
    <meta
      name="description"
      content="A website entitled image uploader which will upload a jpg, jpeg or png image to the server, then you will get the link below."
    />
    <meta
      name="keywords"
      content="tmp file,image upload, telegraph, image upload link"
    />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="revisit-after" content="1 days" />
    <meta name="author" content="Nanda" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");

      * {
        padding: 0;
        margin: 0;
      }

      body {
        font-family: "Poppins", sans-serif;
      }

      .container {
        background-color: #f4f4f4;
        padding-bottom: 40px;
      }

      .navbar {
        background-color: white;
        height: 40px;
        width: 100%;
        position: fixed;
        padding: 10px 0px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0px 1px 1px 0px #edf2ef;
      }

      .brand img {
        padding: 0px 10px;
        width: 40px;
        height: auto;
      }

      .nav-mobile {
        padding: 0px 10px;
      }

      .offcanvas-menu {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #161616;
        z-index: 1001;
        overflow: hidden;
        text-align: center;
      }

      .menu-items {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
      }

      .offcanvas-menu a {
        display: block;
        padding: 10px;
        color: white;
        text-decoration: none;
        font-size: 28px;
        margin: 10px;
        border-radius: 10px;
        opacity: 70%;
      }

      .offcanvas-menu a:hover {
        background-color: #212121;
        opacity: 100%;
      }

      .close-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 3em;
        text-decoration: none;
        cursor: pointer;
        color: white;
      }

      .about-dropdown {
        display: hidden;
        width: 40%;
      }

      .about-dropdown p {
        color: white;
        opacity: 90%;
        text-align: justify;
      }

      .about-btn.active {
        border-bottom: 2px solid #fff;
        opacity: 100%;
      }

      .title {
        padding: 80px 0px 0px 0px;
        text-align: center;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
      }

      p {
        color: gray;
        text-align: center;
        font-size: 0.9em;
      }

      .main-content {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .card {
        width: 80%;
        padding: 10px;
        border-radius: 10px;
      }

      .info-box {
        border-radius: 10px;
        padding: 10px;
        display: flex;
        background-color: white;
        justify-content: space-between;
        box-shadow: #333 2px 2px 2px 2px;
      }

      .info-text {
        font-size: 0.9em;
        padding-bottom: 10px;
        color: gray;
      }

      .icon {
        font-size: 1.7em;
        margin: auto;
        padding-right: 5px;
      }

      .icon2 {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .card1 {
        margin-left: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .group {
        margin-top: 30px;
        display: flex;
        justify-content: space-between;
      }

      .views-box {
        margin-right: 20%;
        width: 90%;
        border-radius: 10px;
        padding: 10px;
        display: flex;
        background-color: white;
        justify-content: space-between;
        box-shadow: #333 2px 2px 2px 2px;
      }
      .clock-box {
        width: 90%;
        border-radius: 10px;
        padding: 5px;
        display: flex;
        background-color: white;
        justify-content: space-between;
        box-shadow: #333 2px 2px 2px 2px;
      }

      #clock,
      #views,
      #uploaded-file {
        font-weight: bold;
      }
      .image-box {
        margin-left: 20%;
        width: 90%;
        border-radius: 10px;
        padding: 10px;
        display: flex;
        background-color: white;
        justify-content: space-between;
        box-shadow: #333 2px 2px 2px 2px;
      }

      .history {
        padding: 50px 20px 0px;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
      }

      .table-container {
        overflow-x: auto;
        margin: 20px auto;
        width: 80%;
      }

      table {
        border-collapse: collapse;
        width: 100%;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        white-space: nowrap;
      }

      th {
        background-color: #4caf50;
        color: white;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      #prevBtn,
      #nextBtn {
        padding: 10px 20px;
        font-size: 16px;
        margin: 10px;
        cursor: pointer;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
      }

      #prevBtn:disabled,
      #nextBtn:disabled {
        background-color: #aaa;
        cursor: not-allowed;
      }

      #prevBtn:hover,
      #nextBtn:hover {
        background-color: #45a049;
      }

      .view-image-button {
        display: inline-block;
        padding: 8px 16px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s ease;
      }

      .view-image-button:hover {
        background-color: #0056b3;
      }

      @media only screen and (max-width: 768px) {
        .group {
          flex-direction: column;
        }
        .views-box {
          margin-bottom: 20px;
          width: 95%;
        }
        .clock-box {
          margin-bottom: 20px;
          width: 98%;
        }

        .image-box {
          margin: 0;
          margin-bottom: 20px;
          width: 95%;
        }

        table {
          min-width: 800px;
          overflow-x: auto;
        }

        .table-container {
          width: 90%;
        }

        .about-dropdown {
          width: 70%;
        }
      }
    </style>
  </head>
  <body>
    <div class="overlay"></div>
    <div class="offcanvas-menu">
      <a href="#" class="close-btn">X</a>
      <div class="menu-items">
        <a href="/">Home</a>
        <a href="/dashboard">Dashboard</a>
        <a href="#" class="about-btn">About</a>
        <div class="about-dropdown" style="display: none">
          <p>
            Welcome to Image Upload Site! We provide easy and fast image upload
            services. You can upload your favorite images and get direct links
            to them. Use our features to share images with friends or embed them
            on your website.
          </p>
          <br />
          <p>
            it's very simple: click the "Upload" button, select the image you
            want to share, and get a direct link to use anywhere. Thank you for
            choosing our service!
          </p>
        </div>
      </div>
    </div>

    <div class="navbar">
      <div class="brand">
        <a href="/"><img src="/src/brand.png"" alt="brand"></a>
      </div>

      <div class="nav-mobile">
        <a href="#" class="menu">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="32"
            width="32"
            viewBox="0 0 448 512"
          >
            <path
              d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"
            />
          </svg>
        </a>
      </div>
    </div>

    <div class="container">
      <div class="title">
        <h1>Dashboard <i class="fa-solid fa-gauge-high"></i></h1>
      </div>
      <div class="main-content">
        <div class="card">
          <div class="info-box">
            <div class="card1">
              <p class="info-text">Info website</p>
              <span id="randomText"></span>
            </div>
            <div class="icon2">
              <i class="fa-solid fa-circle-info icon"></i>
            </div>
          </div>

          <div class="group">
            <div class="views-box">
              <div class="card1">
                <p class="info-text">Views</p>
                <span id="views"><%= formattedVisitorCount %></span>
              </div>
              <div class="icon2">
                <i class="fa-solid fa-eye icon"></i>
              </div>
            </div>

            <div class="clock-box">
              <div class="card1">
                <p class="info-text">Time</p>
                <span id="clock"></span>
                <span
                  id="greating"
                  style="font-size: 0.9em; color: gray; padding-top: 1px"
                ></span>
              </div>
              <div class="icon2">
                <i class="fa-regular fa-clock icon"></i>
              </div>
            </div>

            <div class="image-box">
              <div class="card1">
                <p class="info-text">Image Uploaded</p>
                <span id="uploaded-file"><%= filesInFolder %></span>
              </div>
              <div class="icon2">
                <i class="fa-solid fa-cloud-arrow-up icon"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="history">
        <h1 style="text-align: center">History</h1>
        <p>Below is the history of files uploaded in public mode</p>
      </div>
      <div class="table-container">
        <table border="1">
          <thead>
            <tr>
              <th>No</th>
              <th>File Name</th>
              <th>Upload Time</th>
              <th>Size</th>
              <th>Ext</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- isi -->
          </tbody>
        </table>
      </div>

      <div style="text-align: center">
        <button id="prevBtn" onclick="prevPage()">Previous</button>
        <button id="nextBtn" onclick="nextPage()">Next</button>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        $(".menu").click(function () {
          $(".overlay, .offcanvas-menu").fadeIn();
          $(".about-btn").removeClass("active");
          $(".about-dropdown").fadeOut();
        });

        $(".close-btn, .overlay").click(function () {
          $(".overlay, .offcanvas-menu, .about-dropdown").fadeOut();
          $(".about-btn").removeClass("active");
        });

        $(".about-btn").click(function () {
          $(".about-dropdown").slideToggle();
          $(this).toggleClass("active");
        });
      });

      let currentPage = 1;
      const itemsPerPage = 50;
      let jsonData;

      async function fetchJSON() {
        try {
          const response = await fetch("/database/database.json");
          jsonData = await response.json();
          readPageParameter();
          generateTableRows();
        } catch (error) {
          console.error("Error fetching JSON:", error);
        }
      }

      function formatFileSize(bytes) {
        if (bytes >= 1024 * 1024) {
          return (bytes / (1024 * 1024)).toFixed(2) + " MB";
        } else if (bytes >= 1024) {
          return (bytes / 1024).toFixed(2) + " KB";
        } else {
          return bytes + " bytes";
        }
      }

      function generateTableRows() {
        const tableBody = document.getElementById("table-body");
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;

        jsonData.image.sort(
          (a, b) => new Date(b.uploadTime) - new Date(a.uploadTime)
        );

        tableBody.innerHTML = "";

        jsonData.image.slice(startIndex, endIndex).forEach((image, index) => {
          const row = tableBody.insertRow();
          row.insertCell(0).textContent = startIndex + index + 1;
          row.insertCell(1).textContent = image.fileName;
          row.insertCell(2).textContent = formatUploadTime(image.uploadTime);
          row.insertCell(3).textContent = formatFileSize(image.size);
          row.insertCell(4).textContent = image.extension;
          row.insertCell(
            5
          ).innerHTML = `<a href="${image.link}" target="_blank" class="view-image-button">View Image</a>`;
        });

        updateButtonVisibility();
      }

      function formatUploadTime(uploadTime) {
        const date = new Date(uploadTime);
        const formattedDate = `${padZero(date.getDate())}-${padZero(
          date.getMonth() + 1
        )}--${date.getFullYear()} ${padZero(date.getHours())}:${padZero(
          date.getMinutes()
        )}`;
        return formattedDate;
      }

      function padZero(number) {
        return number < 10 ? `0${number}` : `${number}`;
      }

      function updateButtonVisibility() {
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage * itemsPerPage >= jsonData.image.length;
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          generateTableRows();
          updateURL();
        }
      }

      function nextPage() {
        const totalPages = Math.ceil(jsonData.image.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          generateTableRows();
          updateURL();
        }
      }

      function updateURL() {
        const url = new URL(window.location.href);
        url.searchParams.set("page", currentPage);
        window.history.replaceState({}, "", url);
      }

      function readPageParameter() {
        const url = new URL(window.location.href);
        const pageParam = url.searchParams.get("page");
        if (pageParam && !isNaN(pageParam)) {
          currentPage = parseInt(pageParam, 10);
        }
      }

      fetchJSON();

      function updateClock() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, "0");
        const minutes = now.getMinutes().toString().padStart(2, "0");
        const seconds = now.getSeconds().toString().padStart(2, "0");

        const clockElement = document.getElementById("clock");
        clockElement.textContent = `${hours}:${minutes}:${seconds}`;
      }

      setInterval(updateClock, 1000);

      updateClock();

      function updateGreeting() {
        const now = new Date();
        const hours = now.getHours();

        let greeting = "";
        if (hours < 12) {
          greeting = "Good morning!";
        } else if (hours < 18) {
          greeting = "Good afternoon!";
        } else if (hours < 22) {
          greeting = "Good evening!";
        } else {
          greeting = "Good night!";
        }

        document.getElementById("greating").textContent = greeting;
      }

      updateGreeting();

      function getRandomMessage() {
        const messages = [
          "Hello!",
          "Welcome!",
          "Upload your image and get the URL!",
          "Explore our image uploading service!",
          "Share your moments with a click!",
          "Start uploading and sharing images now!",
          "Your memories, our storage!",
          "Instantly upload and share images",
          "Transform your images into shareable links!",
          "Capture the moment, share the link!",
          "Effortless image sharing made simple",
          "Get ready to share your favorite images",
          "A click away from sharing your images!",
          "Join us in the world of image sharing",
          "Unleash the power of quick image uploads",
          "Share your visual stories effortlessly",
          "Discover the easiest way to share images",
          "Upload, share, and enjoy your images!",
          "Your image, your link, your story!",
          "Connect through the art of image sharing",
          "Experience the joy of hassle-free image uploads",
          "Your images deserve the spotlight!",
          "Embrace the beauty of your moments",
          "Every picture tells a unique story",
          "Let your images speak volumes",
          "Cherish the memories, share the joy",
          "In every image, a tale unfolds",
          "Create memories, share smiles",
          "Images that resonate, stories that inspire",
          "Capturing moments, sharing happiness",
          "Life is a canvas, paint it with pictures",
          "A snapshot of joy for the world to see",
          "The beauty of life through your lens",
          "Share the magic through your images",
          "In the gallery of life, you're the artist",
          "Transform pixels into precious memories",
          "Images that light up your world",
          "Let your pictures be the melody of your story",
          "Life's journey, captured in pixels",
        ];

        const randomIndex = Math.floor(Math.random() * messages.length);
        return messages[randomIndex];
      }

      function updateRandomText() {
        const randomTextElement = document.getElementById("randomText");
        if (randomTextElement) {
          randomTextElement.textContent = getRandomMessage();
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        updateRandomText();

        window.addEventListener("beforeunload", function () {
          updateRandomText();
        });
      });
    </script>
  </body>
</html>
